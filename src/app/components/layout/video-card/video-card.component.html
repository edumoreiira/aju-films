<div class="bg-stone-100 rounded-3xl relative overflow-hidden" InterObs obsClass="fade-in" [intersectChild]="true">

    @for (card of videoCards; track card.id) { 
        @if(card.id === selectedVideoCard) {
            <div class="flex flex-col-reverse sm:flex-row gap-0 lg:gap-12 max-h-full">
                <div class="flex flex-col flex-grow justify-between gap-10 p-10">
                    <div [@fadeSlide]="'up'">
                        <h2 class="text-2xl md:text-4xl font-bold mb-2 md:mb-4">{{card.title}}</h2>
                        <p class="text-stone-600 text-lg md:text-xl mb-6">{{card.description}}</p>
                        <a class="bg-primary text-white py-2.5 px-4 sm:py-3 sm:px-6 text-md sm:text-lg font-medium rounded-full
                        hover:brightness-105 active:brightness-110 transition"
                        href="https://wa.me/+5579996121414?text=Ol%C3%A1,%20desejo%20solicitar%20um%20or%C3%A7amento!"
                        role="button"
                        target="_blank">Solicitar orçamento</a>
                    </div>
                    <div class="flex items-center justify-between gap-7">
                        <div class="flex items-center self-center sm:self-start gap-6 py-2 rounded-2xl w-[min(30rem,100%)]">
                            @for (card of videoCards; track card.id) {
                                <button class="flex flex-grow flex-col-reverse gap-1 justify-center cursor-pointer group"
                                (click)="setVideoCard(card.id)" [attr.aria-label]="'Mudar para vídeo ' + card.title">
                                    <div class="w-full h-[5px] bg-stone-300 rounded-full">
                                        <div class="h-[5px] rounded-full bg-primary transition-all ease-linear" [style.width.%]="card.progress"></div>
                                    </div>
                                </button>
                            }
                        </div>
                        <div class="flex items-center gap-4 justify-between">
                            <button class="p-1.5 rounded-full text-white bg-primary/70
                            hover:bg-primary/90 active:bg-primary transition-colors"
                            (click)="previousVideoCard()">
                                <i class="flex fi fi-sr-angle-small-left"></i>
                            </button>
                            <button class="p-1.5 rounded-full text-white bg-primary/70
                            hover:bg-primary/90 active:bg-primary transition-colors"
                            (click)="nextVideoCard()">
                                <i class="flex fi fi-sr-angle-small-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="relative h-full flex-shrink-0 p-3" [@fadeSlide]="'noslide'">
                    <video #videoRef class="max-h-full aspect-[1/1.4] mx-auto w-[min(600px,100%)] 
                    h-auto sm:h-full sm:w-80 object-cover rounded-2xl skeleton"
                    (timeupdate)="updateProgress(videoRef)" (click)="togglePause(videoRef)" (ended)="onVideoEnd()"
                    [src]="card.videoUrl" type="video/mp4" (canplaythrough)="onLoadedVideo($event)"
                    [muted]="true" [autoplay]="true" [playsInline]="true">
                    </video>
                    <a href="https://www.instagram.com/ajufilms/" target="_blank" class="absolute right-1/2 
                    translate-x-1/2 bottom-8 bg-black px-4 py-2 bg-opacity-40 
                    backdrop-blur-lg whitespace-nowrap rounded-full text-white
                    opacity-60 text-sm hover:opacity-85 active:opacity-100 transition"
                    >Ver mais no instagram</a>
                    @if(videoRef.paused === true) {
                        <button class="absolute right-1/2 bottom-1/2 translate-y-1/2 translate-x-1/2
                        bg-black p-6 bg-opacity-20 backdrop-blur-[2px] rounded-full transition-opacity hover:opacity-70" 
                        (click)="videoRef.play()" [@fadeSlide]="'fastnoslide'">
                            <i class="fi fi-rr-play flex text-x text-white opacity-60"></i>
                        </button>
                    }
                </div>
            </div>
        }
    }
</div>